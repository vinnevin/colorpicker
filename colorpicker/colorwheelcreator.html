<!DOCTYPE html>
<html>
	<head>
		<title>WCAG Color picker</title>
		<style type="text/css">
			#colorWheel {
				width: 200px;
				height: 200px;
				border: 1px solid black;
			}
			.pixel {
				float: left;
				width: 1px;
				height: 1px;
			}

		</style>
	</head>
	<body>
		<div id="colorWheel"></div>
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script type="text/javascript">
			function positionToDegrees ( x, y, radius ) {
				x -= radius; y -= radius;
				var theta = Math.atan2(-y, x);
				if ( theta < 0 ) theta += 2 * Math.PI;
				return Math.round(theta * (180 / Math.PI));
			}

			function distanceFromCenter ( x, y, radius ) {
				x -= radius;
				y -= radius;
				return Math.sqrt((x*x) + (y*y))
			}

			function hslToRgb ( h, s, l ) {
				var r, g, b;
				if ( s == 0 ) {
					r = g = b = l; // achromatic
				} else {
					function hue2rgb ( p, q, t ) {
						if ( t < 0 ) t += 1;
						if ( t > 1 ) t -= 1;
						if ( t < 1/6 ) return p + (q - p) * 6 * t;
						if ( t < 1/2 ) return q;
						if ( t < 2/3 ) return p + (q - p) * (2/3 - t) * 6;
						return p;
					}
					var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
					var p = 2 * l - q;
					r = hue2rgb(p, q, h + 1/3);
					g = hue2rgb(p, q, h);
					b = hue2rgb(p, q, h - 1/3);
				}
				return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
			}

			function calculateLuminance ( h, s, l ) {
				var rgb = hslToRgb(h,s,l);
				var a = rgb.map(function(v) {
					v /= 255;
					return (v <= 0.03928) ? v / 12.92 : Math.pow( ((v+0.055)/1.055), 2.4 );
		        });
		        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
			}

			function drawColorWheel ( target ) {
				target = $(target);
				var width = target.width();
				var radius = width/2;
				for ( var x = 1; x <= width; x ++ ) {
					for ( var y = 1; y <= width; y++ ) {
						var dis = distanceFromCenter(x, y, radius);
						var pixel = $('<span class="pixel"></span>');
						if ( dis <= radius ) {
							var deg = positionToDegrees(x, y, radius);
							var h = Math.round(deg/3.6)/100;
							var s = 1;
							var l = 1 - Math.round(((dis)*100)/radius)/100;
							var rgb = hslToRgb(h,s,l);
							$(pixel).css('background', 'rgb(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ')');
						}
						target.append(pixel);
					}
				}
			}

			function drawLimitedColorWheel ( target, ch, cs, cl ) {
				target = $(target);
				var width = target.width();
				var radius = width/2;
				for ( var x = 1; x <= width; x ++ ) {
					for ( var y = 1; y <= width; y++ ) {
						var dis = distanceFromCenter(x, y, radius);
						var pixel = $('<span class="pixel"></span>');
						if ( dis <= radius ) {
							var deg = positionToDegrees(x, y, radius);
							var h = Math.round(deg/3.6)/100;
							var s = 1;
							var l = 1 - Math.round(((dis)*100)/radius)/100;

							var luminance = calculateLuminance(h, s, l);
							var cLuminance = calculateLuminance(ch, cs, cl);
							
							var contrastRatio = ( luminance > cLuminance )? (luminance + 0.05)/(cLuminance + 0.05) : (cLuminance + 0.05)/(luminance + 0.05);

							if ( contrastRatio > 7 ) {
								var rgb = hslToRgb(h,s,l);
								$(pixel).css('background', 'rgb(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ')');
							}
						}
						target.append(pixel);
					}
				}
			}

			//drawColorWheel('#colorWheel');
			drawLimitedColorWheel('#colorWheel', 0.2, 1, 0.5);
		</script>
	</body>
</html>